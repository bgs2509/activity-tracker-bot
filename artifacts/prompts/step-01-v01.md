# –ü—Ä–æ–º–ø—Ç –¥–ª—è –®–∞–≥–∞ 1: MVP Telegram-–±–æ—Ç–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

> **–í–µ—Ä—Å–∏—è**: 1.0
> **–î–∞—Ç–∞**: 2025-10-29
> **Maturity Level**: Level 1 (PoC) ‚Äî Proof of Concept –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–¥–µ–∏
> **–†–∞—Å—á—ë—Ç–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**: ~5-7 –º–∏–Ω—É—Ç
> **Framework**: doc4microservices (Improved Hybrid Approach)

---

## üéØ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞

### Target Configuration

- **Maturity Level**: **1 - PoC (Proof of Concept)**
- **–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è**: Solo —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, MVP –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–¥–µ–∏
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏**: FastAPI (data service), Aiogram (bot), PostgreSQL, Redis
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏**: –ù–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ PoC
- **–†–∞—Å—á—ë—Ç–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**: ~5-7 –º–∏–Ω—É—Ç

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (.framework/)

‚úÖ **Improved Hybrid Approach** ‚Äî —Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–µ–ø–∞—Ä–∞—Ü–∏—è
‚úÖ **HTTP-only data access** ‚Äî –±–æ—Ç –ù–ï –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ë–î –Ω–∞–ø—Ä—è–º—É—é
‚úÖ **Service separation** ‚Äî –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
‚úÖ **3-part naming** ‚Äî `{context}_{domain}_{type}`
‚úÖ **Docker Compose** ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (PoC)
‚ùå **Nginx API Gateway** ‚Äî –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC (—Ç–æ–ª—å–∫–æ –¥–ª—è Level 3+)
‚ùå **Structured logging** ‚Äî –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC (console logs OK)
‚ùå **Prometheus/Grafana** ‚Äî –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –°–µ—Ä–≤–∏—Å—ã (Microservices)

–°–æ–≥–ª–∞—Å–Ω–æ `.framework/docs/atomic/architecture/improved-hybrid-overview.md`:

#### 1. **tracker_activity_bot** (Aiogram Business Service)

- **–¢–∏–ø**: Business service (Telegram bot)
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Aiogram 3.x, Python 3.11+
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–Ω–æ–ø–æ—á–Ω—ã–π), –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
- **Data access**: **–¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ HTTP** –∫ `data_postgres_api`
- **–•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM**: Redis
- **Container**: Docker

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞**:
- ‚ùå **–ù–ï –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ PostgreSQL**
- ‚úÖ **–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î —á–µ—Ä–µ–∑ HTTP API** (`data_postgres_api`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç FSM (Finite State Machine) –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞–µ—Ç/–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ REST API

#### 2. **data_postgres_api** (FastAPI Data Service)

- **–¢–∏–ø**: Data service (HTTP API –¥–ª—è PostgreSQL)
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: FastAPI, SQLAlchemy 2.0 async, Python 3.11+
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL –ë–î
- **Endpoints**: REST API –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ users, categories, activities
- **Container**: Docker

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞**:
- ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å –ø—Ä—è–º—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ PostgreSQL
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP endpoints –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω (Repository Pattern)
- ‚úÖ SQLAlchemy async ORM

#### 3. **PostgreSQL Database**

- **–í–µ—Ä—Å–∏—è**: PostgreSQL 15+
- **Container**: Docker (official postgres:15-alpine)
- **–î–æ—Å—Ç—É–ø**: –¢–û–õ–¨–ö–û –¥–ª—è `data_postgres_api`

#### 4. **Redis**

- **–í–µ—Ä—Å–∏—è**: Redis 7+
- **Container**: Docker (official redis:7-alpine)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: FSM storage –¥–ª—è Aiogram (—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–∏–∞–ª–æ–≥–æ–≤)
- **–î–æ—Å—Ç—É–ø**: –¢–û–õ–¨–ö–û –¥–ª—è `tracker_activity_bot`

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
activity-tracker-bot/
‚îú‚îÄ‚îÄ .framework/                        # Git submodule (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
‚îÇ   ‚îú‚îÄ‚îÄ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ templates/                     # –®–∞–±–ª–æ–Ω—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ CLAUDE.md                      # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ tracker_activity_bot/          # Aiogram bot service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # Entry point
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/                  # Message & callback handlers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py               # /start command
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ activity.py            # –ó–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categories.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ list.py                # –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards/                 # Inline keyboards
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categories.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ time_select.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ states/                    # FSM states
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ activity.py            # States –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ category.py            # States –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                  # HTTP client –¥–ª—è data API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http_client.py         # Base HTTP client
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py        # Users API calls
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ category_service.py    # Categories API calls
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ activity_service.py    # Activities API calls
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ time_parser.py         # –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ (14:30, 30–º, 2—á)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.py          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # Settings (from .env)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                 # Single-stage build (PoC)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/                     # Pytest tests
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ data_postgres_api/             # FastAPI data service
‚îÇ       ‚îú‚îÄ‚îÄ main.py                    # FastAPI app entry point
‚îÇ       ‚îú‚îÄ‚îÄ routers/                   # API routers
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ users.py               # /api/v1/users/*
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ categories.py          # /api/v1/categories/*
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ activities.py          # /api/v1/activities/*
‚îÇ       ‚îú‚îÄ‚îÄ models/                    # SQLAlchemy models
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ user.py                # User model
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ category.py            # Category model
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ activity.py            # Activity model
‚îÇ       ‚îú‚îÄ‚îÄ repositories/              # Repository pattern
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ base.py                # Base repository
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ user_repository.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ category_repository.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ activity_repository.py
‚îÇ       ‚îú‚îÄ‚îÄ schemas/                   # Pydantic schemas (DTOs)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ user.py                # UserCreate, UserResponse
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ category.py            # CategoryCreate, CategoryResponse
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ activity.py            # ActivityCreate, ActivityResponse
‚îÇ       ‚îú‚îÄ‚îÄ database/                  # Database setup
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ connection.py          # Async engine, sessionmaker
‚îÇ       ‚îú‚îÄ‚îÄ config.py                  # Settings (from .env)
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile                 # Single-stage build (PoC)
‚îÇ       ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ       ‚îú‚îÄ‚îÄ tests/                     # Pytest tests
‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml                 # Local development setup
‚îú‚îÄ‚îÄ .env.example                       # Environment variables template
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ Makefile                           # Development commands
‚îî‚îÄ‚îÄ README.md                          # Project documentation
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

### –¢–∞–±–ª–∏—Ü–∞: `users`

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram –±–æ—Ç–∞.

| –°—Ç–æ–ª–±–µ—Ü | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|-------------|----------|
| `id` | SERIAL | PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID |
| `telegram_id` | BIGINT | NOT NULL, UNIQUE | Telegram user ID |
| `username` | VARCHAR(255) | NULLABLE | Telegram username (@username) |
| `first_name` | VARCHAR(255) | NULLABLE | –ò–º—è –∏–∑ Telegram |
| `timezone` | VARCHAR(50) | NOT NULL, DEFAULT 'Europe/Moscow' | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `created_at` | TIMESTAMP | NOT NULL, DEFAULT NOW() | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

**–ò–Ω–¥–µ–∫—Å—ã**:
- `UNIQUE INDEX idx_users_telegram_id ON users(telegram_id)`

---

### –¢–∞–±–ª–∏—Ü–∞: `categories`

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π (—É–Ω–∏–∫–∞–ª—å–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

| –°—Ç–æ–ª–±–µ—Ü | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|-------------|----------|
| `id` | SERIAL | PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID |
| `user_id` | INTEGER | NOT NULL, FOREIGN KEY ‚Üí users(id) | –í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| `name` | VARCHAR(100) | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| `emoji` | VARCHAR(10) | NULLABLE | –≠–º–æ–¥–∑–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (1-2 —Å–∏–º–≤–æ–ª–∞) |
| `is_default` | BOOLEAN | NOT NULL, DEFAULT FALSE | –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (—Å–æ–∑–¥–∞–Ω–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) |
| `created_at` | TIMESTAMP | NOT NULL, DEFAULT NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- `INDEX idx_categories_user_id ON categories(user_id)`
- `UNIQUE INDEX idx_categories_user_name ON categories(user_id, name)` ‚Äî —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º

**Constraints**:
- `FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE`

---

### –¢–∞–±–ª–∏—Ü–∞: `activities`

–ó–∞–ø–∏—Å–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –°—Ç–æ–ª–±–µ—Ü | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|-------------|----------|
| `id` | SERIAL | PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID |
| `user_id` | INTEGER | NOT NULL, FOREIGN KEY ‚Üí users(id) | –í–ª–∞–¥–µ–ª–µ—Ü –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ |
| `category_id` | INTEGER | NULLABLE, FOREIGN KEY ‚Üí categories(id) | –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ |
| `description` | TEXT | NOT NULL | –û–ø–∏—Å–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ |
| `tags` | TEXT | NULLABLE | –¢–µ–≥–∏ (JSON array –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) |
| `start_time` | TIMESTAMP | NOT NULL | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (UTC) |
| `end_time` | TIMESTAMP | NOT NULL | –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (UTC) |
| `duration_minutes` | INTEGER | NOT NULL | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö |
| `created_at` | TIMESTAMP | NOT NULL, DEFAULT NOW() | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

**–ò–Ω–¥–µ–∫—Å—ã**:
- `INDEX idx_activities_user_id ON activities(user_id)`
- `INDEX idx_activities_user_start_time ON activities(user_id, start_time DESC)` ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—ã–±–æ—Ä–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

**Constraints**:
- `FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE`
- `FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL`
- `CHECK (end_time > start_time)` ‚Äî –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø–æ–∑–∂–µ –Ω–∞—á–∞–ª–∞

---

## üîå HTTP API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (data_postgres_api)

### Base URL

```
http://data_postgres_api:8000/api/v1
```

**Naming convention**: REST API paths –∏—Å–ø–æ–ª—å–∑—É—é—Ç kebab-case –¥–ª—è —Å–ª–æ–≤ (`.framework/docs/atomic/architecture/naming/README.md`).

---

### 1. Users API

#### `POST /api/v1/users`

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞).

**Request Body**:
```json
{
  "telegram_id": 123456789,
  "username": "john_doe",
  "first_name": "John",
  "timezone": "Europe/Moscow"
}
```

**Response** (201 Created):
```json
{
  "id": 1,
  "telegram_id": 123456789,
  "username": "john_doe",
  "first_name": "John",
  "timezone": "Europe/Moscow",
  "created_at": "2025-10-29T10:00:00Z"
}
```

---

#### `GET /api/v1/users/by-telegram/{telegram_id}`

–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID.

**Response** (200 OK):
```json
{
  "id": 1,
  "telegram_id": 123456789,
  "username": "john_doe",
  "first_name": "John",
  "timezone": "Europe/Moscow",
  "created_at": "2025-10-29T10:00:00Z"
}
```

**Response** (404 Not Found):
```json
{
  "detail": "User not found"
}
```

---

### 2. Categories API

#### `POST /api/v1/categories`

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request Body**:
```json
{
  "user_id": 1,
  "name": "–•–æ–±–±–∏",
  "emoji": "üé®",
  "is_default": false
}
```

**Response** (201 Created):
```json
{
  "id": 7,
  "user_id": 1,
  "name": "–•–æ–±–±–∏",
  "emoji": "üé®",
  "is_default": false,
  "created_at": "2025-10-29T10:30:00Z"
}
```

**Error** (409 Conflict) ‚Äî –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
```json
{
  "detail": "Category with name '–•–æ–±–±–∏' already exists for this user"
}
```

---

#### `POST /api/v1/categories/bulk-create`

–°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏).

**Request Body**:
```json
{
  "user_id": 1,
  "categories": [
    {"name": "–†–∞–±–æ—Ç–∞", "emoji": "üíº", "is_default": true},
    {"name": "–°–ø–æ—Ä—Ç", "emoji": "üèÉ", "is_default": true},
    {"name": "–û—Ç–¥—ã—Ö", "emoji": "üéÆ", "is_default": true},
    {"name": "–û–±—É—á–µ–Ω–∏–µ", "emoji": "üìö", "is_default": true},
    {"name": "–°–æ–Ω", "emoji": "üò¥", "is_default": true},
    {"name": "–ï–¥–∞", "emoji": "üçΩÔ∏è", "is_default": true}
  ]
}
```

**Response** (201 Created):
```json
{
  "created_count": 6,
  "categories": [
    {"id": 1, "name": "–†–∞–±–æ—Ç–∞", "emoji": "üíº", ...},
    {"id": 2, "name": "–°–ø–æ—Ä—Ç", "emoji": "üèÉ", ...},
    ...
  ]
}
```

---

#### `GET /api/v1/categories?user_id={user_id}`

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Response** (200 OK):
```json
[
  {
    "id": 1,
    "user_id": 1,
    "name": "–†–∞–±–æ—Ç–∞",
    "emoji": "üíº",
    "is_default": true,
    "created_at": "2025-10-29T10:00:00Z"
  },
  {
    "id": 7,
    "user_id": 1,
    "name": "–•–æ–±–±–∏",
    "emoji": "üé®",
    "is_default": false,
    "created_at": "2025-10-29T10:30:00Z"
  }
]
```

---

#### `DELETE /api/v1/categories/{category_id}`

–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

**Response** (204 No Content) ‚Äî —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ

**Response** (400 Bad Request) ‚Äî –ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:
```json
{
  "detail": "Cannot delete the last category for user"
}
```

---

### 3. Activities API

#### `POST /api/v1/activities`

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

**Request Body**:
```json
{
  "user_id": 1,
  "category_id": 1,
  "description": "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",
  "tags": ["–ø—Ä–æ–µ–∫—Ç_X", "—Å—Ä–æ—á–Ω–æ"],
  "start_time": "2025-10-29T14:30:00Z",
  "end_time": "2025-10-29T16:00:00Z"
}
```

**Response** (201 Created):
```json
{
  "id": 42,
  "user_id": 1,
  "category_id": 1,
  "description": "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",
  "tags": ["–ø—Ä–æ–µ–∫—Ç_X", "—Å—Ä–æ—á–Ω–æ"],
  "start_time": "2025-10-29T14:30:00Z",
  "end_time": "2025-10-29T16:00:00Z",
  "duration_minutes": 90,
  "created_at": "2025-10-29T16:05:00Z"
}
```

**–í–∞–∂–Ω–æ**: `duration_minutes` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```python
duration_minutes = round((end_time - start_time).total_seconds() / 60)
```

---

#### `GET /api/v1/activities?user_id={user_id}&limit={limit}&offset={offset}`

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–∞–≥–∏–Ω–∞—Ü–∏—è).

**Query Parameters**:
- `user_id` (required) ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `limit` (optional, default=10) ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `offset` (optional, default=0) ‚Äî —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**Response** (200 OK):
```json
{
  "total": 42,
  "items": [
    {
      "id": 42,
      "user_id": 1,
      "category_id": 1,
      "description": "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",
      "tags": ["–ø—Ä–æ–µ–∫—Ç_X", "—Å—Ä–æ—á–Ω–æ"],
      "start_time": "2025-10-29T14:30:00Z",
      "end_time": "2025-10-29T16:00:00Z",
      "duration_minutes": 90,
      "created_at": "2025-10-29T16:05:00Z"
    },
    ...
  ]
}
```

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –ø–æ `start_time DESC` (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞).

---

## ü§ñ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Telegram Bot)

### 1. –ö–æ–º–∞–Ω–¥–∞ `/start` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ë–æ—Ç –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å:
   ```
   GET /api/v1/users/by-telegram/{telegram_id}
   ```
3. –ï—Å–ª–∏ `404 Not Found` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç):
   - –ë–æ—Ç –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å:
     ```
     POST /api/v1/users
     {
       "telegram_id": ...,
       "username": ...,
       "first_name": ...,
       "timezone": "Europe/Moscow"
     }
     ```
   - –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
     ```
     POST /api/v1/categories/bulk-create
     {
       "user_id": ...,
       "categories": [
         {"name": "–†–∞–±–æ—Ç–∞", "emoji": "üíº", "is_default": true},
         {"name": "–°–ø–æ—Ä—Ç", "emoji": "üèÉ", "is_default": true},
         {"name": "–û—Ç–¥—ã—Ö", "emoji": "üéÆ", "is_default": true},
         {"name": "–û–±—É—á–µ–Ω–∏–µ", "emoji": "üìö", "is_default": true},
         {"name": "–°–æ–Ω", "emoji": "üò¥", "is_default": true},
         {"name": "–ï–¥–∞", "emoji": "üçΩÔ∏è", "is_default": true}
       ]
     }
     ```
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
     ```
     üëã –ü—Ä–∏–≤–µ—Ç, [–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]!

     –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.

     –î–ª—è —Ç–µ–±—è —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
     üíº –†–∞–±–æ—Ç–∞  üèÉ –°–ø–æ—Ä—Ç  üéÆ –û—Ç–¥—ã—Ö
     üìö –û–±—É—á–µ–Ω–∏–µ  üò¥ –°–æ–Ω  üçΩÔ∏è –ï–¥–∞

     –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:

     [–ö–Ω–æ–ø–∫–∞: üìù –ó–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]
     [–ö–Ω–æ–ø–∫–∞: üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏]
     [–ö–Ω–æ–ø–∫–∞: üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏]
     [–ö–Ω–æ–ø–∫–∞: ‚ùì –°–ø—Ä–∞–≤–∫–∞]
     ```

4. –ï—Å–ª–∏ `200 OK` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å):
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
     ```
     üëã –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, [–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]!

     –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:

     [–ö–Ω–æ–ø–∫–∞: üìù –ó–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]
     [–ö–Ω–æ–ø–∫–∞: üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏]
     [–ö–Ω–æ–ø–∫–∞: üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏]
     [–ö–Ω–æ–ø–∫–∞: ‚ùì –°–ø—Ä–∞–≤–∫–∞]
     ```

---

### 2. –ó–∞–ø–∏—Å—å –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π FSM)

**–¢—Ä–∏–≥–≥–µ—Ä**: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "üìù –ó–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"

**FSM States** (–≤ `tracker_activity_bot/states/activity.py`):
```python
class ActivityStates(StatesGroup):
    waiting_for_start_time = State()
    waiting_for_end_time = State()
    waiting_for_description = State()
    waiting_for_category = State()
```

#### –®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
‚è∞ –£–∫–∞–∂–∏ –≤—Ä–µ–º—è –ù–ê–ß–ê–õ–ê –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ú–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
‚Ä¢ –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è: 14:30 –∏–ª–∏ 14-30
‚Ä¢ –ú–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥: 30–º –∏–ª–∏ 30 (–Ω–∞—á–∞–ª–æ—Å—å 30 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)
‚Ä¢ –ß–∞—Å—ã –Ω–∞–∑–∞–¥: 2—á –∏–ª–∏ 2h (–Ω–∞—á–∞–ª–æ—Å—å 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥)

–ü—Ä–∏–º–µ—Ä—ã:
14:30 ‚Äî –Ω–∞—á–∞–ª–æ—Å—å –≤ 14:30
90–º ‚Äî –Ω–∞—á–∞–ª–æ—Å—å 90 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
2—á ‚Äî –Ω–∞—á–∞–ª–æ—Å—å 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥

[–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:]
[–ö–Ω–æ–ø–∫–∞: 30–º –Ω–∞–∑–∞–¥] [–ö–Ω–æ–ø–∫–∞: 1—á –Ω–∞–∑–∞–¥] [–ö–Ω–æ–ø–∫–∞: 2—á –Ω–∞–∑–∞–¥]

[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `ActivityStates.waiting_for_start_time`

**–ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏** (–≤ `utils/time_parser.py`):
- `14:30`, `14-30` ‚Üí 14 —á–∞—Å–æ–≤ 30 –º–∏–Ω—É—Ç —Å–µ–≥–æ–¥–Ω—è (–≤ timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- `30–º`, `30` ‚Üí —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –º–∏–Ω—É—Å 30 –º–∏–Ω—É—Ç
- `2—á`, `2h` ‚Üí —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –º–∏–Ω—É—Å 2 —á–∞—Å–∞

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- ‚ùå –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º
- ‚ùå –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ —á–µ–º 24 —á–∞—Å–∞ –Ω–∞–∑–∞–¥

–ï—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
```
‚ö†Ô∏è –ù–µ –º–æ–≥—É —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –≤—Ä–µ–º—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.

–ü—Ä–∏–º–µ—Ä—ã: 14:30, 90–º, 2—á

[–ö–Ω–æ–ø–∫–∞: 30–º –Ω–∞–∑–∞–¥] [–ö–Ω–æ–ø–∫–∞: 1—á –Ω–∞–∑–∞–¥] [–ö–Ω–æ–ø–∫–∞: 2—á –Ω–∞–∑–∞–¥]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

–ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞:
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `start_time` –≤ FSM data
- –ü–µ—Ä–µ–π—Ç–∏ –≤ `ActivityStates.waiting_for_end_time`

---

#### –®–∞–≥ 2: –ó–∞–ø—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
‚è∞ –£–∫–∞–∂–∏ –≤—Ä–µ–º—è –û–ö–û–ù–ß–ê–ù–ò–Ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ù–∞—á–∞–ª–æ—Å—å: [–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞]

–ú–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
‚Ä¢ –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è: 16:00
‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 30–º (–¥–ª–∏–ª–æ—Å—å 30 –º–∏–Ω—É—Ç)
‚Ä¢ "–°–µ–π—á–∞—Å" –∏–ª–∏ "0" ‚Äî –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —á—Ç–æ

[–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:]
[–ö–Ω–æ–ø–∫–∞: –°–µ–π—á–∞—Å]
[–ö–Ω–æ–ø–∫–∞: 30–º –¥–ª–∏–ª–æ—Å—å] [–ö–Ω–æ–ø–∫–∞: 1—á –¥–ª–∏–ª–æ—Å—å] [–ö–Ω–æ–ø–∫–∞: 2—á –¥–ª–∏–ª–æ—Å—å]

[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `ActivityStates.waiting_for_end_time`

**–ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏**:
- `16:00`, `16-00` ‚Üí 16 —á–∞—Å–æ–≤ 00 –º–∏–Ω—É—Ç —Å–µ–≥–æ–¥–Ω—è
- `—Å–µ–π—á–∞—Å`, `now`, `0` ‚Üí —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- `30–º`, `30` ‚Üí **start_time –ø–ª—é—Å 30 –º–∏–Ω—É—Ç** (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å!)
- `2—á`, `2h` ‚Üí **start_time –ø–ª—é—Å 2 —á–∞—Å–∞**

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- ‚úÖ `end_time > start_time`
- ‚ùå `end_time` –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º

–ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞:
```
‚ö†Ô∏è –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–∑–∂–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞.

–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.

[–ö–Ω–æ–ø–∫–∞: –°–µ–π—á–∞—Å]
[–ö–Ω–æ–ø–∫–∞: 30–º –¥–ª–∏–ª–æ—Å—å] [–ö–Ω–æ–ø–∫–∞: 1—á –¥–ª–∏–ª–æ—Å—å]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

–ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞:
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `end_time` –≤ FSM data
- –í—ã—á–∏—Å–ª–∏—Ç—å `duration_minutes` (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –ü–µ—Ä–µ–π—Ç–∏ –≤ `ActivityStates.waiting_for_description`

---

#### –®–∞–≥ 3: –ó–∞–ø—Ä–æ—Å –æ–ø–∏—Å–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üìù –û–ø–∏—à–∏ —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

–ü–µ—Ä–∏–æ–¥: [–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞] ‚Äî [–≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è]
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: [X —á–∞—Å–æ–≤ Y –º–∏–Ω—É—Ç]

–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–ª –≤ —ç—Ç–æ –≤—Ä–µ–º—è?

üí° –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ #
–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º #–≤–∞–∂–Ω–æ–µ #–¥–µ–¥–ª–∞–π–Ω

[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `ActivityStates.waiting_for_description`

**–û–±—Ä–∞–±–æ—Ç–∫–∞**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç: "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ #–ø—Ä–æ–µ–∫—Ç_X #—Å—Ä–æ—á–Ω–æ"
- –ë–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–≥–∏: `["–ø—Ä–æ–µ–∫—Ç_X", "—Å—Ä–æ—á–Ω–æ"]` (–≤—Å—ë –ø–æ—Å–ª–µ `#`, –±–µ–∑ —Å–∞–º–æ–≥–æ `#`)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `description` –∏ `tags` –≤ FSM data
- –ü–µ—Ä–µ–π—Ç–∏ –≤ `ActivityStates.waiting_for_category`

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏

---

#### –®–∞–≥ 4: –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

–ë–æ—Ç –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å:
```
GET /api/v1/categories?user_id={user_id}
```

–ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏:
```
üìÇ –í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

–û–ø–∏—Å–∞–Ω–∏–µ: [–æ–ø–∏—Å–∞–Ω–∏–µ]
–ü–µ—Ä–∏–æ–¥: [–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞] ‚Äî [–≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è]

[Inline-–∫–Ω–æ–ø–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –≤ 2 –∫–æ–ª–æ–Ω–∫–∏:]
[üíº –†–∞–±–æ—Ç–∞] [üèÉ –°–ø–æ—Ä—Ç]
[üéÆ –û—Ç–¥—ã—Ö] [üìö –û–±—É—á–µ–Ω–∏–µ]
[üò¥ –°–æ–Ω] [üçΩÔ∏è –ï–¥–∞]
[üé® –•–æ–±–±–∏] [–¥—Ä—É–≥–∏–µ...]

[–ö–Ω–æ–ø–∫–∞: ‚ûñ –ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `ActivityStates.waiting_for_category`

**Callback data format**: `category:{category_id}` –∏–ª–∏ `category:none`

**–û–±—Ä–∞–±–æ—Ç–∫–∞**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `category_id` (–∏–ª–∏ `None`) –≤ FSM data
- –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é

---

#### –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

–ë–æ—Ç –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å:
```
POST /api/v1/activities
{
  "user_id": 1,
  "category_id": 1,
  "description": "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",
  "tags": ["–ø—Ä–æ–µ–∫—Ç_X", "—Å—Ä–æ—á–Ω–æ"],
  "start_time": "2025-10-29T14:30:00Z",
  "end_time": "2025-10-29T16:00:00Z"
}
```

**–í–∞–∂–Ω–æ**:
- –í—Å–µ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **UTC** (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ user timezone ‚Üí UTC)
- `duration_minutes` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (`201 Created`):
```
‚úÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∞–Ω–∞!

üíº –†–∞–±–æ—Ç–∞
–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
üè∑ #–ø—Ä–æ–µ–∫—Ç_X #—Å—Ä–æ—á–Ω–æ

‚è∞ 14:30 ‚Äî 16:00
‚è± –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1—á 30–º

[–ö–Ω–æ–ø–∫–∞: ‚ûï –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]
[–ö–Ω–æ–ø–∫–∞: üìã –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏ –∑–∞–ø–∏—Å–∏]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

–û—á–∏—Å—Ç–∏—Ç—å FSM state.

---

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

#### 3.1. –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–¢—Ä–∏–≥–≥–µ—Ä**: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏"

**HTTP –∑–∞–ø—Ä–æ—Å**:
```
GET /api/v1/categories?user_id={user_id}
```

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞**:
```
üìÇ –¢–≤–æ–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π:

üíº –†–∞–±–æ—Ç–∞
üèÉ –°–ø–æ—Ä—Ç
üéÆ –û—Ç–¥—ã—Ö
üìö –û–±—É—á–µ–Ω–∏–µ
üò¥ –°–æ–Ω
üçΩÔ∏è –ï–¥–∞
üé® –•–æ–±–±–∏

[–ö–Ω–æ–ø–∫–∞: ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

---

#### 3.2. –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (FSM)

**FSM States**:
```python
class CategoryStates(StatesGroup):
    waiting_for_name = State()
    waiting_for_emoji = State()
```

**–®–∞–≥ 1**: –ó–∞–ø—Ä–æ—Å –Ω–∞–∑–≤–∞–Ω–∏—è
```
–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

–ù–∞–ø—Ä–∏–º–µ—Ä: –•–æ–±–±–∏, –°–µ–º—å—è, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç

[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `CategoryStates.waiting_for_name`

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞
- –ú–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤

**–®–∞–≥ 2**: –ó–∞–ø—Ä–æ—Å —ç–º–æ–¥–∑–∏
```
–í—ã–±–µ—Ä–∏ —ç–º–æ–¥–∑–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–•–æ–±–±–∏":

[Inline-–∫–Ω–æ–ø–∫–∏ —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —ç–º–æ–¥–∑–∏ –≤ 4 –∫–æ–ª–æ–Ω–∫–∏:]
[üé®] [üéµ] [üì∑] [üéØ]
[‚úàÔ∏è] [üöó] [üè†] [üë®‚Äçüë©‚Äçüëß]
[üí∞] [üõí] [üì±] [‚öôÔ∏è]
[üìû] [üé™] [üé≠] [üé¨]

–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —ç–º–æ–¥–∑–∏ —Ç–µ–∫—Å—Ç–æ–º

[–ö–Ω–æ–ø–∫–∞: ‚ûñ –ë–µ–∑ —ç–º–æ–¥–∑–∏]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

**State**: `CategoryStates.waiting_for_emoji`

**HTTP –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏**:
```
POST /api/v1/categories
{
  "user_id": 1,
  "name": "–•–æ–±–±–∏",
  "emoji": "üé®",
  "is_default": false
}
```

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**:
```
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è "üé® –•–æ–±–±–∏" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!

[–ö–Ω–æ–ø–∫–∞: ‚ûï –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –∫–∞—Ç–µ–≥–æ—Ä–∏—é]
[–ö–Ω–æ–ø–∫–∞: üìÇ –ö —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ `409 Conflict`** (–∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):
```
‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–•–æ–±–±–∏" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í–≤–µ–¥–∏ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.

[–ö–Ω–æ–ø–∫–∞: ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

---

#### 3.3. –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é

**–®–∞–≥ 1**: –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏

**HTTP –∑–∞–ø—Ä–æ—Å**:
```
GET /api/v1/categories?user_id={user_id}
```

**–°–æ–æ–±—â–µ–Ω–∏–µ**:
```
–í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:

[–ö–Ω–æ–ø–∫–∞: üíº –†–∞–±–æ—Ç–∞]
[–ö–Ω–æ–ø–∫–∞: üèÉ –°–ø–æ—Ä—Ç]
[–ö–Ω–æ–ø–∫–∞: üéÆ –û—Ç–¥—ã—Ö]
[–ö–Ω–æ–ø–∫–∞: üìö –û–±—É—á–µ–Ω–∏–µ]
[–ö–Ω–æ–ø–∫–∞: üò¥ –°–æ–Ω]
[–ö–Ω–æ–ø–∫–∞: üçΩÔ∏è –ï–¥–∞]
[–ö–Ω–æ–ø–∫–∞: üé® –•–æ–±–±–∏]

[–ö–Ω–æ–ø–∫–∞: üîô –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

**Callback data**: `delete_category:{category_id}`

**–®–∞–≥ 2**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
```
‚ö†Ô∏è –¢—ã —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "üé® –•–æ–±–±–∏"?

–í—Å–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

[–ö–Ω–æ–ø–∫–∞: ‚úÖ –î–∞, —É–¥–∞–ª–∏—Ç—å]
[–ö–Ω–æ–ø–∫–∞: ‚ùå –ù–µ—Ç, –æ—Ç–º–µ–Ω–∏—Ç—å]
```

**HTTP –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏**:
```
DELETE /api/v1/categories/{category_id}
```

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**:
```
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è "üé® –•–æ–±–±–∏" —É–¥–∞–ª–µ–Ω–∞.

[–ö–Ω–æ–ø–∫–∞: üìÇ –ö —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ `400 Bad Request`** (–ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é):
```
‚ö†Ô∏è –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –î–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞.

[–ö–Ω–æ–ø–∫–∞: üìÇ –ö —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

---

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

**–¢—Ä–∏–≥–≥–µ—Ä**: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏"

**HTTP –∑–∞–ø—Ä–æ—Å**:
```
GET /api/v1/activities?user_id={user_id}&limit=10&offset=0
```

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞** (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º):
```
üìã –¢–≤–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÖ 29 –æ–∫—Ç—è–±—Ä—è 2025
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üíº –†–∞–±–æ—Ç–∞ | 14:30 ‚Äî 16:00 (1—á 30–º)
–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –æ—Ç—á—ë—Ç–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
üè∑ #–ø—Ä–æ–µ–∫—Ç_X #—Å—Ä–æ—á–Ω–æ

üçΩÔ∏è –ï–¥–∞ | 13:00 ‚Äî 13:30 (30–º)
–û–±–µ–¥ –≤ –∫–∞—Ñ–µ
üè∑ #–æ–±–µ–¥

üìö –û–±—É—á–µ–Ω–∏–µ | 10:00 ‚Äî 12:00 (2—á)
–ò–∑—É—á–∞–ª –Ω–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
üè∑ #python #–æ–±—É—á–µ–Ω–∏–µ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÖ 28 –æ–∫—Ç—è–±—Ä—è 2025
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üèÉ –°–ø–æ—Ä—Ç | 19:00 ‚Äî 20:00 (1—á)
–ü—Ä–æ–±–µ–∂–∫–∞ –≤ –ø–∞—Ä–∫–µ

üíº –†–∞–±–æ—Ç–∞ | 09:00 ‚Äî 13:00 (4—á)
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
üè∑ #–ø—Ä–æ–µ–∫—Ç_Y

[–ö–Ω–æ–ø–∫–∞: ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]
[–ö–Ω–æ–ø–∫–∞: üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

**–í–∞–∂–Ω–æ**:
- –î–∞—Ç—ã –∏ –≤—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ UTC –≤ timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º (–≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø–∏—Å–µ–π
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º

**–ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–µ—Ç**:
```
üìã –£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.

–ù–∞—á–Ω–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!

[–ö–Ω–æ–ø–∫–∞: ‚ûï –ó–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å]
[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

---

### 5. –°–ø—Ä–∞–≤–∫–∞

**–¢—Ä–∏–≥–≥–µ—Ä**: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "‚ùì –°–ø—Ä–∞–≤–∫–∞"

**–°–æ–æ–±—â–µ–Ω–∏–µ**:
```
üìñ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º:

üìù –ó–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
–î–æ–±–∞–≤—å –Ω–æ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å —Ç–æ—á–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º

üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏
–ü–æ—Å–º–æ—Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
–£–ø—Ä–∞–≤–ª—è–π —Å–≤–æ–∏–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏: –¥–æ–±–∞–≤–ª—è–π –∏–ª–∏ —É–¥–∞–ª—è–π

üí° –ü—Ä–æ —Ç–µ–≥–∏:
–í –æ–ø–∏—Å–∞–Ω–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ #
–ù–∞–ø—Ä–∏–º–µ—Ä: "–†–∞–±–æ—Ç–∞–ª –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º #–≤–∞–∂–Ω–æ–µ #–¥–µ–¥–ª–∞–π–Ω"

‚è∞ –§–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏:
‚Ä¢ 14:30 ‚Äî —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è
‚Ä¢ 30–º ‚Äî 30 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
‚Ä¢ 2—á ‚Äî 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
‚Ä¢ —Å–µ–π—á–∞—Å ‚Äî –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

[–ö–Ω–æ–ø–∫–∞: üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

**–°–æ–≥–ª–∞—Å–Ω–æ PoC Level** (–ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ):

1. **–í –ë–î (PostgreSQL)**: –í—Å—ë —Ö—Ä–∞–Ω–∏–º –≤ **UTC** (TIMESTAMP)
2. **–û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–≤–æ–¥)**: –°—á–∏—Ç–∞–µ–º —á—Ç–æ –≤—Ä–µ–º—è –≤ **–µ–≥–æ timezone** (`Europe/Moscow` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã–≤–æ–¥)**: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º UTC ‚Üí –µ–≥–æ timezone

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏** (–≤ `utils/time_parser.py`):

```python
import pytz
from datetime import datetime

def parse_user_time(time_str: str, user_timezone: str = "Europe/Moscow") -> datetime:
    """
    –ü–∞—Ä—Å–∏—Ç –≤—Ä–µ–º—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç datetime –≤ UTC.

    –ü—Ä–∏–º–µ—Ä—ã:
        "14:30" ‚Üí —Å–µ–≥–æ–¥–Ω—è 14:30 –≤ user_timezone ‚Üí UTC
        "30–º" ‚Üí —Å–µ–π—á–∞—Å –º–∏–Ω—É—Å 30 –º–∏–Ω—É—Ç ‚Üí UTC
        "2—á" ‚Üí —Å–µ–π—á–∞—Å –º–∏–Ω—É—Å 2 —á–∞—Å–∞ ‚Üí UTC
    """
    tz = pytz.timezone(user_timezone)

    if ":" in time_str or "-" in time_str:
        # –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è
        ...
    elif time_str.endswith("–º") or time_str.isdigit():
        # –ú–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥
        ...
    elif time_str.endswith("—á") or time_str.endswith("h"):
        # –ß–∞—Å—ã –Ω–∞–∑–∞–¥
        ...

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ UTC
    return local_dt.astimezone(pytz.UTC)
```

---

### FSM Storage (Redis)

**Aiogram FSM** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π:

```python
# tracker_activity_bot/main.py

from aiogram.fsm.storage.redis import RedisStorage

storage = RedisStorage.from_url("redis://redis:6379/0")
dp = Dispatcher(storage=storage)
```

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ FSM**:
```python
await state.update_data(
    start_time=start_time_utc,
    end_time=end_time_utc,
    description="...",
    tags=["tag1", "tag2"],
    category_id=1
)
```

---

### HTTP Client (–¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ data API)

**Base HTTP Client** (–≤ `services/http_client.py`):

```python
import httpx
from config import settings

class DataAPIClient:
    def __init__(self):
        self.base_url = settings.DATA_API_URL  # http://data_postgres_api:8000
        self.client = httpx.AsyncClient(base_url=self.base_url, timeout=10.0)

    async def get(self, path: str, **kwargs):
        response = await self.client.get(path, **kwargs)
        response.raise_for_status()
        return response.json()

    async def post(self, path: str, **kwargs):
        response = await self.client.post(path, **kwargs)
        response.raise_for_status()
        return response.json()

    async def delete(self, path: str, **kwargs):
        response = await self.client.delete(path, **kwargs)
        response.raise_for_status()
        return response.status_code
```

**User Service** (–≤ `services/user_service.py`):

```python
class UserService:
    def __init__(self, client: DataAPIClient):
        self.client = client

    async def get_by_telegram_id(self, telegram_id: int):
        try:
            return await self.client.get(f"/api/v1/users/by-telegram/{telegram_id}")
        except httpx.HTTPStatusError as e:
            if e.response.status_code == 404:
                return None
            raise

    async def create_user(self, telegram_id: int, username: str, first_name: str):
        return await self.client.post("/api/v1/users", json={
            "telegram_id": telegram_id,
            "username": username,
            "first_name": first_name,
            "timezone": "Europe/Moscow"
        })
```

---

### Dependency Injection –≤ data_postgres_api

**–°–æ–≥–ª–∞—Å–Ω–æ `.framework/docs/atomic/services/fastapi/dependency-injection.md`**:

```python
# data_postgres_api/database/connection.py

from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker

engine = create_async_engine("postgresql+asyncpg://user:pass@postgres:5432/tracker_db")
async_session = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

async def get_db() -> AsyncSession:
    async with async_session() as session:
        yield session
```

**–í —Ä–æ—É—Ç–µ—Ä–∞—Ö**:

```python
# data_postgres_api/routers/users.py

from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from database.connection import get_db

router = APIRouter(prefix="/api/v1/users")

@router.post("/")
async def create_user(
    user: UserCreate,
    db: AsyncSession = Depends(get_db)
):
    repository = UserRepository(db)
    return await repository.create(user)
```

---

## üê≥ Docker Compose (PoC Level)

**–§–∞–π–ª**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: tracker_db
    environment:
      POSTGRES_USER: tracker_user
      POSTGRES_PASSWORD: tracker_password
      POSTGRES_DB: tracker_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U tracker_user -d tracker_db"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis (–¥–ª—è FSM)
  redis:
    image: redis:7-alpine
    container_name: tracker_redis
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # FastAPI Data Service
  data_postgres_api:
    build:
      context: ./services/data_postgres_api
      dockerfile: Dockerfile
    container_name: data_postgres_api
    environment:
      DATABASE_URL: postgresql+asyncpg://tracker_user:tracker_password@postgres:5432/tracker_db
      LOG_LEVEL: INFO
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  # Aiogram Telegram Bot
  tracker_activity_bot:
    build:
      context: ./services/tracker_activity_bot
      dockerfile: Dockerfile
    container_name: tracker_activity_bot
    environment:
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      DATA_API_URL: http://data_postgres_api:8000
      REDIS_URL: redis://redis:6379/0
      LOG_LEVEL: INFO
    depends_on:
      - redis
      - data_postgres_api
    restart: unless-stopped

volumes:
  postgres_data:
```

**–§–∞–π–ª**: `.env.example`

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_here

# PostgreSQL
POSTGRES_USER=tracker_user
POSTGRES_PASSWORD=tracker_password
POSTGRES_DB=tracker_db

# Data API
DATABASE_URL=postgresql+asyncpg://tracker_user:tracker_password@postgres:5432/tracker_db

# Redis
REDIS_URL=redis://redis:6379/0

# Logging
LOG_LEVEL=INFO
```

---

## ‚úÖ Acceptance Criteria (Quality Gates –¥–ª—è PoC)

**–°–æ–≥–ª–∞—Å–Ω–æ `.framework/docs/reference/maturity-levels.md` (Level 1 - PoC)**:

### Functional Validation

‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ `/start`
‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è 6 –±–∞–∑–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (5-—à–∞–≥–æ–≤—ã–π FSM)
‚úÖ –í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –ø–∞—Ä—Å—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (14:30, 30–º, 2—á, —Å–µ–π—á–∞—Å)
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
‚úÖ –¢–µ–≥–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è (#—Ç–µ–≥)
‚úÖ –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –¥–∞—Ç–∞–º –≤ —Å–ø–∏—Å–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

### Architecture Validation

‚úÖ **HTTP-only data access**: –±–æ—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ë–î –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ `data_postgres_api`
‚úÖ **Service separation**: –±–æ—Ç –∏ data API –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
‚úÖ **3-part naming**: `tracker_activity_bot`, `data_postgres_api`
‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–∞ –¢–û–õ–¨–ö–û –¥–ª—è `data_postgres_api`
‚úÖ Redis –¥–æ—Å—Ç—É–ø–µ–Ω –¢–û–õ–¨–ö–û –¥–ª—è `tracker_activity_bot`

### Quality Gates (PoC Level)

‚úÖ **Linting** (Ruff):
```bash
ruff check services/tracker_activity_bot
ruff check services/data_postgres_api
```

‚úÖ **Type Checking** (Mypy):
```bash
mypy services/tracker_activity_bot --strict
mypy services/data_postgres_api --strict
```

‚úÖ **Unit Tests** (Pytest):
```bash
pytest services/tracker_activity_bot/tests --cov=services/tracker_activity_bot --cov-report=term-missing
pytest services/data_postgres_api/tests --cov=services/data_postgres_api --cov-report=term-missing
```

**Coverage target –¥–ª—è PoC**: ‚â• 60% (–¥–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–¥–µ–∏)

‚ùå **Security scanning** (–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC)
‚ùå **Integration tests** (–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC)
‚ùå **Performance tests** (–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è PoC)

### Deployment Validation

‚úÖ `docker-compose up -d` –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
‚úÖ Health checks –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–ª—è PostgreSQL –∏ Redis
‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start` –≤ Telegram
‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —É–≤–∏–¥–µ—Ç—å –µ—ë –≤ —Å–ø–∏—Å–∫–µ

---

## üöÄ Next Steps (–∑–∞ —Ä–∞–º–∫–∞–º–∏ PoC)

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ PoC –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫:**

### Level 2 (Development Ready) ‚Äî ~10 –º–∏–Ω—É—Ç

- ‚úÖ Structured logging (JSON format, request IDs)
- ‚úÖ Health check endpoints (`/health`, `/ready`)
- ‚úÖ Integration tests (—Å testcontainers)
- ‚úÖ Coverage target ‚â• 75%

### Level 3 (Pre-Production) ‚Äî ~15 –º–∏–Ω—É—Ç

- ‚úÖ Nginx API Gateway (reverse proxy, load balancing)
- ‚úÖ SSL/TLS support (Let's Encrypt)
- ‚úÖ Prometheus metrics + Grafana dashboards
- ‚úÖ Rate limiting
- ‚úÖ Multi-stage Docker builds

### Level 4 (Production) ‚Äî ~30 –º–∏–Ω—É—Ç

- ‚úÖ OAuth 2.0 / JWT authentication
- ‚úÖ RBAC (Role-Based Access Control)
- ‚úÖ ELK Stack (Elasticsearch, Logstash, Kibana)
- ‚úÖ Distributed tracing (Jaeger)
- ‚úÖ Database replication (HA)
- ‚úÖ CI/CD pipelines
- ‚úÖ Automated backups

**–°–º.**: `.framework/docs/reference/maturity-levels.md`

---

## üìö –°—Å—ã–ª–∫–∏ –Ω–∞ .framework/ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:**

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `.framework/docs/guides/architecture-guide.md` ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- `.framework/docs/atomic/architecture/improved-hybrid-overview.md` ‚Äî Improved Hybrid Approach
- `.framework/docs/atomic/architecture/data-access-architecture.md` ‚Äî HTTP-only data access
- `.framework/docs/atomic/architecture/service-separation-principles.md` ‚Äî –°–µ—Ä–≤–∏—Å–Ω–∞—è —Å–µ–ø–∞—Ä–∞—Ü–∏—è

### Naming Conventions
- `.framework/docs/atomic/architecture/naming/README.md` ‚Äî –ü–æ–ª–Ω—ã–π –≥–∏–¥ –ø–æ naming
- `.framework/docs/atomic/architecture/naming/naming-services.md` ‚Äî Naming –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- `.framework/docs/atomic/architecture/naming/naming-python.md` ‚Äî Naming –¥–ª—è Python –∫–æ–¥–∞

### Aiogram (Bot Service)
- `.framework/docs/atomic/services/aiogram/basic-setup.md` ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Aiogram
- `.framework/docs/atomic/services/aiogram/bot-initialization.md` ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
- `.framework/docs/atomic/services/aiogram/handler-patterns.md` ‚Äî –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `.framework/docs/atomic/services/aiogram/state-management.md` ‚Äî FSM (Finite State Machine)

### FastAPI (Data Service)
- `.framework/docs/atomic/services/fastapi/basic-setup.md` ‚Äî –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ FastAPI
- `.framework/docs/atomic/services/fastapi/routing-patterns.md` ‚Äî –†–æ—É—Ç–∏–Ω–≥ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API
- `.framework/docs/atomic/services/fastapi/dependency-injection.md` ‚Äî Dependency Injection

### PostgreSQL
- `.framework/docs/atomic/databases/postgresql/basic-setup.md` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL
- `.framework/docs/atomic/databases/postgresql/sqlalchemy-integration.md` ‚Äî SQLAlchemy 2.0 async

### Redis
- `.framework/docs/atomic/integrations/redis/connection-management.md` ‚Äî Redis connection pooling
- `.framework/docs/atomic/integrations/redis/aiogram-integration.md` ‚Äî Aiogram + Redis FSM

### HTTP Communication
- `.framework/docs/atomic/integrations/http-communication/business-to-data-calls.md` ‚Äî Business ‚Üí Data HTTP –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- `.framework/docs/atomic/integrations/http-communication/http-client-patterns.md` ‚Äî HTTP client –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Docker & Infrastructure
- `.framework/docs/atomic/infrastructure/containerization/docker-compose-setup.md` ‚Äî Docker Compose best practices
- `.framework/docs/atomic/infrastructure/containerization/dockerfile-patterns.md` ‚Äî Dockerfile –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### Testing
- `.framework/docs/atomic/testing/unit-testing/pytest-setup.md` ‚Äî Pytest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `.framework/docs/atomic/testing/quality-assurance/linting-standards.md` ‚Äî Ruff, Mypy —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

### Maturity Levels
- `.framework/docs/reference/maturity-levels.md` ‚Äî 4 —É—Ä–æ–≤–Ω—è –∑—Ä–µ–ª–æ—Å—Ç–∏ (PoC ‚Üí Production)
- `.framework/docs/reference/conditional-stage-rules.md` ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ `.framework/docs/reference/project-structure.md`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `docker-compose.yml` —Å PostgreSQL, Redis
- [ ] –°–æ–∑–¥–∞—Ç—å `.env.example` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Makefile –¥–ª—è –∫–æ–º–∞–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 2: Data Service (data_postgres_api)

- [ ] –°–æ–∑–¥–∞—Ç—å FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (entry point)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SQLAlchemy async engine + sessionmaker
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏: `User`, `Category`, `Activity`
- [ ] –°–æ–∑–¥–∞—Ç—å Pydantic schemas (DTOs)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Repository Pattern (UserRepository, CategoryRepository, ActivityRepository)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä—ã: `/api/v1/users`, `/api/v1/categories`, `/api/v1/activities`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit tests (coverage ‚â• 60%)
- [ ] Dockerfile (single-stage –¥–ª—è PoC)

### –≠—Ç–∞–ø 3: Bot Service (tracker_activity_bot)

- [ ] –°–æ–∑–¥–∞—Ç—å Aiogram –±–æ—Ç (entry point)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RedisStorage –¥–ª—è FSM
- [ ] –°–æ–∑–¥–∞—Ç—å HTTP client –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ data API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã: UserService, CategoryService, ActivityService
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FSM states: ActivityStates, CategoryStates
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å handlers:
  - [ ] `/start` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)
  - [ ] –ó–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (5 —à–∞–≥–æ–≤ FSM)
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å)
  - [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
  - [ ] –°–ø—Ä–∞–≤–∫–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å inline keyboards (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `utils/time_parser.py` (–ø–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `utils/formatters.py` (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit tests (coverage ‚â• 60%)
- [ ] Dockerfile (single-stage –¥–ª—è PoC)

### –≠—Ç–∞–ø 4: Quality Gates

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Ruff (linting)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Mypy (type checking)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `ruff check` –Ω–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `mypy --strict` –Ω–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `pytest` —Å coverage ‚â• 60%

### –≠—Ç–∞–ø 5: Integration Testing

- [ ] `docker-compose up -d` —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- [ ] Health checks PostgreSQL –∏ Redis –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start` –≤ Telegram
- [ ] –ú–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –∑–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞
- [ ] –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- [ ] –í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å—è—Ç—Å—è

### –≠—Ç–∞–ø 6: Documentation

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `README.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints (OpenAPI –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ FastAPI)
- [ ] –°–æ–∑–¥–∞—Ç—å `services/tracker_activity_bot/README.md`
- [ ] –°–æ–∑–¥–∞—Ç—å `services/data_postgres_api/README.md`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –£–ø—Ä–æ—â–µ–Ω–∏—è –¥–ª—è PoC (Level 1)

1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Console logs (print statements –¥–æ–ø—É—Å—Ç–∏–º—ã)
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ù–ï–¢ (–∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π user_id)
3. **Secrets management**: `.env` —Ñ–∞–π–ª (–ù–ï production-ready)
4. **Error handling**: –ë–∞–∑–æ–≤—ã–π (–±–µ–∑ Sentry)
5. **Monitoring**: –ù–ï–¢ Prometheus/Grafana
6. **API Gateway**: –ù–ï–¢ Nginx (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º)
7. **SSL/TLS**: –ù–ï–¢ (HTTP only –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### –ß—Ç–æ –ù–ï –≤–∫–ª—é—á–µ–Ω–æ –≤ –®–∞–≥ 1

- ‚ùå –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 2)
- ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 2)
- ‚ùå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 3)
- ‚ùå –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV, JSON) (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 3)
- ‚ùå –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–≥—Ä–∞—Ñ–∏–∫–∏, –¥–∏–∞–≥—Ä–∞–º–º—ã) (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 4)
- ‚ùå Multi-user —Ä–µ–∂–∏–º (–±—É–¥–µ—Ç –≤ –®–∞–≥–µ 5+)
- ‚ùå Webhook –¥–ª—è Telegram (—Å–µ–π—á–∞—Å polling)

---

**–ö–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –®–∞–≥–∞ 1**

**–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–º–ø—Ç**: `step-02-v01.md` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π, –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Level 2 (Development Ready).
